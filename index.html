
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>劈柴者</title>
    <meta name="author" content="或与非">

    
    <meta name="description" content="Haskell 文学编程系统中的 Tangle 工具的实现 Haskell 语言自身便是一种半文学编程系统，因为它的函数可以按照人类的思维逻辑进行组织，但是它缺乏 Knuth WEB 中\quotation{节}的灵活性与可读性。Haskell 文学编程系统这个项目（下面简称 HWEB） &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="/atom.xml" rel="alternate" title="劈柴者" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    

</head>

<body>
	<header class="inner"><h1 class="left"><a href="/">劈柴者</a></h1>
<nav class="menu left"><ul class="main">
	<li><a href="/">笔记</a></li>
	<li><a href="/blog/archives">归档</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:ghacker.github.com">
	</form>
	<div class="social right">
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	
	<div id="content" class="inner">


    <article class="post">
    <h1 class="title"><a href="/blog/2012/07/08/htangle/">Haskell 文学编程系统中的 Tangle 工具的实现</a></h1>
    <div class="entry">
        <p>Haskell 语言自身便是一种半文学编程系统，因为它的函数可以按照人类的思维逻辑进行组织，但是它缺乏 Knuth WEB 中\quotation{节}的灵活性与可读性。Haskell 文学编程系统这个项目（下面简称 HWEB）的主要目的就是基于 haskell 与 \CONTEXT\ MkIV 排版语言为 Haskell 实现一个完备的文学编程系统。</p>

<h2>HWEB 语言与 htangle 工具</h2>

<p>HWEB 语言类似于非常轻量级的标记语言——Markdown，但是在普通的文本区域皆可自由的插入 \CONTEXT\ 命令。由 HWEB 语言所写的\quotation{程序}，我们称之为 HWEB 文章。</p>

<p>HWEB 文章是由若干\quotation{节} 构成。节可将 HWEB 文章划分为树形结构，基于这一结构，我们就可以像撰写一份传统的文章那样来写一个 HWEB 程序。在节所构成的树形结构的基础上，节与节之间可以相互引用，因此我们实际得到的是网状结构，这是以 WEB 为名的原由。</p>

<p>每一节都是以一个或多个连续的 \type{#} 符号开始，节的层次性体现于 \type{#} 符号的个数。例如 \type{###} 表示第三层的节。</p>

<p>要记住，下一节的开始就是当前节的终止。</p>

<p>尾随 \type{#} 符号序列的是节的标题，其终止符是换行符。节的标题可以为空，这样在产生的 \CONTEXT\ 文档中就会得到只有序号但是没有标题的小节。</p>

<p>每一节均由两个部分构成，自然语言部分与 Haskell 语言部分，它们各自的职能是：</p>

<ul>
<li>自然语言部分：使用人类语言来描述这一节所实现的程序功能或程序逻辑；</li>
<li>Haskell 语言部分：具体的 Haskell 代码片段或者 HWEB 宏。</li>
</ul>


<p>这两个部分中的任一个皆可为空，但是如果它们都存在，那么自然语言部分必须要先于 Haskell 语言部分。</p>

<p>对于一篇 HWEB 文章，htangle 工具可从中将全部的 Haskell 代码准确的提取出来，对其编译即可得到 HWEB 程序的 Haskell 实体。</p>

<h2>htangle 的自举实现过程</h2>

<p>为了保证 htangle 的实现过程是一个自举过程，也就是说用 HWEB 文章来写 htangle 自身。这个过程的需要一个起源。</p>

<p>在起源阶段，虽然 htangle 工具是基于 HWEB 代码实现，但是 Haskell 代码需要人工从 HWEB 代码中抽取，只有如此方可得到第一个可用的 htangle。</p>

<p>一旦有了第一个 htangle，那么它便成为当前可用的 htangle，其下一个版本依然通过 HWEB 实现，但是 Haskell 代码的抽取途径变为利用当前版本的 htangle 工具并配合少量的人工抽取方式，然后编译所抽取的 haskell 代码即可得到新版本的 htangle。</p>

<p>这个迭代过程，便能够使得 htangle 一直处于进化状态，等到我厌倦之时，也就是这个迭代过程收敛之时。</p>

<h2>htangle 程序结构概览</h2>

<p>在 HWEB 语言中，\type{&lt;&lt;宏名>>} 符号表示 HWEB 宏。像 HWEB 的节那样，所有 HWEB 宏能够树状结构构建 Haskell 程序的逻辑。</p>

<p>\type{&lt;&lt;*>>} 表示 HWEB 宏的根结点，这意味着其他 HWEB 宏或具体的 Haskell 代码皆为其子结点。</p>

<p>利用 HWEB 宏的根结点及作为子结点的其他 HWEB 宏可将 htangle 程序的总的逻辑描述为：</p>

<pre><code>&lt;&lt;*&gt;&gt; = &lt;&lt;导入所需模块&gt;&gt;
        &lt;&lt;定义 HWEB 宏相关数据结构&gt;&gt;
        &lt;&lt;读取 HWEB 文章，构建 HWEB 宏树&gt;&gt;
        &lt;&lt;基于 HWEB 宏树生成 Haskell 源码文件&gt;&gt;
</code></pre>

<h2>HWEB 宏的数据结构</h2>

<p>采用 Recorder 类型类表示 HWEB 宏，成员为：宏名、宏的内容以及宏所在 HWEB 文章中的行号。</p>

<pre><code>&lt;&lt;定义 HWEB 宏相关数据结构&gt;&gt; =
data Macro = Macro { name :: String,
                     content :: [String],
                     lineNumber :: Integer
                   } deriving (Show)
</code></pre>

<h2>HWEB 宏树</h2>

<p>从一篇 HWEB 文章中，我们可以将全部的 HWEB 宏提取出来形成列表，然后基于列表所记录的宏信息构建树状结构的 HWEB 宏集，待生成的 Haskell 代码被包含在该宏集的叶结点中。</p>

<h3>HWEB 宏树结构</h3>

<p>HWEB 宏树是一棵 N 叉树结构类型，其定义利用了 Haskell 的递归类型（Recursive Types），在《Real World Haskell》第三章中介绍了这种数据类型的定义。</p>

<pre><code>&lt;&lt;定义 HWEB 宏相关数据结构&gt;&gt; =
data MarcroTree = Node String [MacroTree]
     | Empty
     deriving (Show)
</code></pre>

<h3>HWEB 宏树结点的更新</h3>

<p>由于 Haskell 不支持数据的修改，如何更新一棵 HWEB 宏树便成了实现 htangle 过程中遇到的第一个令人头疼的问题。为了解决这个问题，我需要阅读《Learn You a Haskell for Great Good》第 15 章。</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-07-08T19:09:00+08:00" pubdate data-updated="true">Jul 8<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/haskell/'>Haskell</a>, <a class='category' href='/blog/categories/文学编程/'>文学编程</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2012/05/01/write-yourself-a-scheme-in-48-hours/">48 小时写一个属于你的 Scheme 解释器</a></h1>
    <div class="entry">
        <p>原文见：<a href="http://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours">Write Yourself a Scheme in 48 Hours</a>。本文档对原文档的更新不作出跟随的承诺。</p>

<p>48 小时写一个属于你的 Scheme 解释器，这是一份重要的 Haskell 编程指南，由 Jonathan Tang 所写。感谢 Jonathan 对该文档的授权。贡献者们可以自由修改这份指南的 Wiki 版本！</p>


        
        <a href="/blog/2012/05/01/write-yourself-a-scheme-in-48-hours/" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-05-01T17:04:00+08:00" pubdate data-updated="true">May 1<span>st</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/haskell/'>Haskell</a>, <a class='category' href='/blog/categories/scheme/'>Scheme</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2012/04/13/monads-for-the-curious-porgrammer/">单子求索</a></h1>
    <div class="entry">
        <p>原文见 <a href="http://bartoszmilewski.com">Bartosz Milewski 的系列博文</a>。</p>

<pre><code>如是我闻：

单子空空，力量无限
用之愈多，所得愈多
谈之愈多，知之愈少

           ——《单子之道》
</code></pre>

<p>这样说不知是否夸张，似乎每个懂得了单子的程序员都会写一篇关于它的文章（而且每一篇的开头都是：网络上已经有了许多单子指南，但是……）。原因是对于单子的理解像是一种灵魂感悟，你想与他人分享。</p>

<p>人们对单子的认知如同盲人摸象。你会看到有的人将它描述为容器，有的人将它描述为动作。有的人认为它是用于封装副作用的，也有人将其视为范畴论中自函子的实例。</p>

<p>很难说清楚单子是个什么东西，因为它与我们日常生活中的事物毫无关系。对于面向对象编程中的对象，即使婴儿都知道对象是什么（可以放进嘴里的东西），单子该如何具化？</p>


        
        <a href="/blog/2012/04/13/monads-for-the-curious-porgrammer/" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-13T09:36:00+08:00" pubdate data-updated="true">Apr 13<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/haskell/'>Haskell</a>, <a class='category' href='/blog/categories/单子/'>单子</a>, <a class='category' href='/blog/categories/技术/'>技术</a>
  
</div>

</div>
        
    </div>
</article>

<nav id="pagenavi">
    
    
    <a href="/blog/archives" class="center">Blog Archives</a>
</nav></div>
	<footer class="inner">Copyright &copy; 2012 劈柴者</footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>




</body>
</html>